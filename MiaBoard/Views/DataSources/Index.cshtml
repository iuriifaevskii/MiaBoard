@model MiaBoard.Models.DataSource
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<h1>dataSources</h1>

<div class="container">
    <h2>Modal Example</h2>
    
    <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">Open Modal</button>
    <div class="container">
        <h2>Modal Example</h2>
        <!-- Trigger the modal with a button -->
        

        <!-- Modal -->
        <div class="modal fade" id="myModal" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Modal Header</h4>
                    </div>
                    <div class="modal-body">
                        




                        @using (Html.BeginForm("Save", "DataSources"))
                        {
                            @Html.ValidationSummary(true, "Please fix the following errors.")
                            <div class="form-group">
                                @Html.LabelFor(m => m.Type)
                                @Html.TextBoxFor(m => m.Type, new { @class = "form-control" })
                                @Html.ValidationMessageFor(m => m.Type)
                            </div>
                            <div class="form-group">
                                @Html.LabelFor(m => m.ServerName)
                                @Html.TextBoxFor(m => m.ServerName, new { @class = "form-control" })
                                @Html.ValidationMessageFor(m => m.ServerName)
                            </div>
                            <div class="form-group">
                                @Html.LabelFor(m => m.UserName)
                                @Html.TextBoxFor(m => m.UserName, new { @class = "form-control" })
                                @Html.ValidationMessageFor(m => m.UserName)
                            </div>
                            <div class="form-group">
                                @Html.LabelFor(m => m.Password)
                                @Html.TextBoxFor(m => m.Password, new { @class = "form-control" })
                                @Html.ValidationMessageFor(m => m.Password)
                            </div>
                            <div class="form-group">
                                @Html.LabelFor(m => m.DatabaseName)
                                @Html.TextBoxFor(m => m.DatabaseName, new { @class = "form-control" })
                                @Html.ValidationMessageFor(m => m.DatabaseName)
                            </div>
                            <div class="form-group">
                                @Html.LabelFor(m => m.ConnectionString)
                                @Html.TextBoxFor(m => m.ConnectionString, new { @class = "form-control" })
                                @Html.ValidationMessageFor(m => m.ConnectionString)
                            </div>

                            @Html.HiddenFor(m => m.Id)
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-primary js-update">Save</button>
                        }






                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>

            </div>
        </div>

    </div>

@*@Html.Partial("~/Views/DataSources/_DataSourceForm.cshtml")*@


<table id="dataSources" class="table table-bordered table-hover">
    <thead>
        <tr>
            <th>Data Source Type</th>
            <th>Server Name</th>
            <th>Database Name</th>
            <th>User Name</th>
            <th>Password</th>
            <th>ConnectionString</th>
            <th>Delete</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>
</div>
@section scripts
{
    <script>
        $(document).ready(function () {
            var table = $("#dataSources").DataTable({
                ajax: {
                    url: "/api/dataSources",
                    dataSrc: ""
                },
                columns: [
                    {
                        data: "type",
                        render: function (data, type, dataSource) {
                           // return "<button type='button' data-toggle='modal' data-target='#myModal'>Open Modal</button>"
                            return "<a data-toggle='modal' data-target='#myModal' data-update-id = " + dataSource.id + " '>" + dataSource.type + "</a>";
                        }
                    },
                    {
                        data: "serverName"
                    },
                    {
                        data: "databaseName"
                    },
                    {
                        data: "userName"
                    },
                    {
                        data: "password"
                    },
                    {
                        data: "connectionString"
                    },
                    {
                        data: "id",
                        render: function (data) {
                            return "<button class = 'btn-link js-delete' data-dataSource-id=" + data + ">Delete</button>";
                        }
                    }
                ]
            });
            $("#dataSources").on("click", ".js-update", function () {
                var button = $(this);
                        $.ajax({
                            url: "/api/dataSources/" + button.attr("data-update-id"),
                            method: "PUT",
                            success: function () {
                                table.row(button.parents("tr")).reload().draw();
                            }
                        });
                });
            });
            $("#dataSources").on("click", ".js-delete", function () {
                var button = $(this);

                bootbox.confirm("Are you sure you want to delete this dataSource?", function (result) {
                    if (result) {
                        $.ajax({
                            url: "/api/dataSources/" + button.attr("data-dataSource-id"),
                            method: "DELETE",
                            success: function () {
                                table.row(button.parents("tr")).remove().draw();
                            }
                        });
                    }
                });
            });
        
    </script>
}
